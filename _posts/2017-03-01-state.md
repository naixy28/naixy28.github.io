---
layout: article
title: State Manager
excerpt: 状态管理器
category: tech
tags: javascript
---

# 状态管理器
一个简易的状态管理器，拥有set,get,getState方法，set内部使用深拷贝

## 代码
```javascript
//这里用原始的function写法定义类
function State(initState){
  //默认值
  this.state = initState||{};

  this.get = function(key){
    return this.state[key]||'';
  }
  
  this.getState = function(){
    return this.state;
  } 

  //获取元素真实的类型
  function type(obj){
    return Object.prototype.toString.call(obj).replace(/[\[\]]/g,'').split(' ')[1].toLowerCase();
  }
  
  //使用深拷贝更新原始state
  this.set = function(obj, target){
    //Obejct.keys方法可能有兼容问题，用for in代替
    var keys = Object.keys(obj),
        _target = target||this.state; 

    keys.map(function(key){
      var t = type(obj[key]);
      //Array.prototype.includes方法可能有兼容问题，可以用indexOf代替
      if(  ['string', 'number', 'boolean'].includes(t)  ){
        _target[key] = obj[key];
      }else{
        if( t === 'array'){
          _target[key] = [];
        }else{
          _target[key] = {};
        }
        set(obj[key],_target[key]);
      }
      return key;
    })
  }
}

//使用方法
var state = new State({a:1});

state.set({a:2});
state.get('a');
state.getState();

```

## 要补一个es6版本的class写法
